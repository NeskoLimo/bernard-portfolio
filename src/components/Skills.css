// src/components/Skills.jsx
import { useState, useEffect, useRef } from 'react';
import './Skills.css';

const skills = {
  technical: [
    { name: 'Data Analysis',  level: 95, icon: '◈' },
    { name: 'SQL',            level: 90, icon: '⬡' },
    { name: 'Python',         level: 85, icon: '◎' },
    { name: 'Tableau',        level: 88, icon: '◇' },
    { name: 'Power BI',       level: 87, icon: '◆' },
    { name: 'Excel',          level: 92, icon: '▣' },
  ],
  professional: [
    { name: 'Requirements Gathering',  level: 92, icon: '◈' },
    { name: 'Process Improvement',     level: 88, icon: '⬡' },
    { name: 'Strategic Planning',      level: 85, icon: '◎' },
    { name: 'Stakeholder Management',  level: 90, icon: '◇' },
    { name: 'Project Management',      level: 87, icon: '◆' },
    { name: 'Communication',           level: 93, icon: '▣' },
  ],
};

const categories = [
  { key: 'technical',    label: 'Technical Skills'    },
  { key: 'professional', label: 'Professional Skills' },
];

export default function Skills() {
  const [selectedCategory, setSelectedCategory] = useState('technical');
  const [animated, setAnimated]                 = useState(false);
  const [displayedBars, setDisplayedBars]       = useState({});
  const sectionRef = useRef(null);

  // Animate bars when section enters viewport
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => { if (entry.isIntersecting) setAnimated(true); },
      { threshold: 0.2 }
    );
    if (sectionRef.current) observer.observe(sectionRef.current);
    return () => observer.disconnect();
  }, []);

  // Re-trigger bar animation on category switch
  useEffect(() => {
    setDisplayedBars({});
    const timer = setTimeout(() => {
      const widths = {};
      skills[selectedCategory].forEach((s) => { widths[s.name] = s.level; });
      setDisplayedBars(widths);
    }, 80);
    return () => clearTimeout(timer);
  }, [selectedCategory, animated]);

  return (
    <section className="skills-section" id="skills" ref={sectionRef}>
      <div className="section-container">

        {/* ── Header ─────────────────────────────────────────── */}
        <div className="skills-header">
          <p className="skills-eyebrow">What I Bring</p>
          <h2 className="heading-2">Skills &amp; Expertise</h2>
          <div className="section-divider" />
        </div>

        {/* ── Tab switcher ───────────────────────────────────── */}
        <div className="skills-tabs">
          {categories.map(({ key, label }) => (
            <button
              key={key}
              className={`skills-tab ${selectedCategory === key ? 'skills-tab--active' : ''}`}
              onClick={() => setSelectedCategory(key)}
            >
              {label}
            </button>
          ))}
        </div>

        {/* ── Skills grid ────────────────────────────────────── */}
        <div className="skills-grid">
          {skills[selectedCategory].map((skill, index) => (
            <div
              key={skill.name}
              className="skill-card card"
              style={{ animationDelay: `${index * 0.08}s` }}
            >
              {/* Card header */}
              <div className="skill-card-header">
                <div className="skill-name-row">
                  <span className="skill-icon">{skill.icon}</span>
                  <span className="skill-name">{skill.name}</span>
                </div>
                <span className="skill-percent">
                  {displayedBars[skill.name] ?? 0}%
                </span>
              </div>

              {/* Progress bar */}
              <div className="skill-bar-track">
                <div
                  className="skill-bar-fill"
                  style={{
                    width: animated ? `${displayedBars[skill.name] ?? 0}%` : '0%',
                    transitionDelay: `${index * 0.08}s`,
                  }}
                />
              </div>

              {/* Proficiency label */}
              <span className="skill-tier">
                {skill.level >= 90
                  ? 'Expert'
                  : skill.level >= 85
                  ? 'Advanced'
                  : 'Proficient'}
              </span>
            </div>
          ))}
        </div>

        {/* ── Bottom callout ─────────────────────────────────── */}
        <div className="skills-callout card-glass">
          <p className="skills-callout-text">
            Continuously expanding my toolkit — currently deepening expertise in{' '}
            <span className="text-gold font-semibold">AI-driven analytics</span>{' '}
            and{' '}
            <span className="text-gold font-semibold">process automation</span>.
          </p>
          <a href="#contact" className="btn btn-primary px-6 py-3 text-sm">
            Let's Collaborate
          </a>
        </div>

      </div>
    </section>
  );
}
